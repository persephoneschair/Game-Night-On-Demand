<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="Website/Icon.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">The Penny Bank</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    body {
      background-color: #0a1e3f;
      color: #e0e7ff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #f3ec40;
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      margin-bottom: 2rem;
    }

    .controls {
      text-align: center;
      margin-bottom: 2rem;
    }

    select, input[type="text"] {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background-color: #1e3a8a;
      color: #e0e7ff;
      cursor: pointer;
      margin: 0.5rem;
    }
    
    
/* --- Leaderboard --- */

    .leaderboard {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 1rem;
      padding: 0;
      max-width: 3840px;
      margin: 0 auto;
    }

    @media (min-width: 600px) {
      .leaderboard {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 900px) {
      .leaderboard {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1200px) {
      .leaderboard {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1800px) {
      .leaderboard {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (min-width: 2200px) {
      .leaderboard {
        grid-template-columns: repeat(5, 1fr);
      }
    }

    .entry {
      background: #152a5a;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 1.2rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      white-space: nowrap;
      gap: 0.5rem;
      overflow: hidden;
    }

    .name {
      flex: 1 1 auto;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: bold;
      font-size: 1.5rem;
    }

    .value {
      font-weight: bold;
      font-size: 2rem;
    }

    .entry:hover {
      box-shadow: 0 4px 12px rgba(243, 236, 64, 0.8);
      transform: translateY(-2px);
    }

    .ordinal {
      color: #f3ec40;
      font-weight: bold;
      margin-right: 1rem;
      font-size: 2rem;
      text-shadow: 1px 2px 3px rgba(0, 0, 0, 0.7);
    }

    .gold {
      background-color: #FFFFC5;
      color: #000;
    }

    .silver {
      background-color: #FFFFFF;
      color: #000;
    }

    .bronze {
      background-color: #FFC78F;
      color: #000;
    }

    .gold .ordinal {
      color: #ffd700;
      font-size: 3rem;
    }

    .silver .ordinal {
      color: #DDDDDD;
      font-size: 3rem;
    }

    .bronze .ordinal {
      color: #CD7F32;
      font-size: 3rem;
    }
    
    
    
/* --- Medal Cabinets --- */

#medalBoard {
  display: grid;
  grid-template-columns: repeat(1, 1fr);
  gap: 1rem;
  padding: 0;
  max-width: 3840px;
  margin: 0 auto;
}

@media (min-width: 600px) {
  #medalBoard {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 900px) {
  #medalBoard {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1200px) {
  #medalBoard {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1800px) {
  #medalBoard {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (min-width: 2200px) {
  #medalBoard {
    grid-template-columns: repeat(5, 1fr);
  }
}

.medal-column.total {
  background: none;
  padding: 0;
  border-radius: 0;
}
.medal-column.total h2 {
  text-align: center;
  color: #f3ec40;
  font-family: 'Orbitron', sans-serif;
  font-size: 2rem;
  margin-bottom: 1rem;
}

/* Unified grid layout for medallists */
.medal-grid {

  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

/* Reuse entry card styling from Penny Bank */
.medallist {
  background: #152a5a;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  font-size: 1.2rem;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
  display: flex;
  justify-content: space-between;
  align-items: center;
  white-space: nowrap;
  gap: 0.5rem;
  overflow: hidden;
}
.medallist:hover {
  box-shadow: 0 4px 12px rgba(243, 236, 64, 0.8);
  transform: translateY(-2px);
}

.medallist > span:nth-child(1) {
  flex: 0 0 auto;
  font-size: 2rem;
  color: #f3ec40;
  font-weight: bold;
  margin-right: 1rem;
  text-shadow: 1px 2px 3px rgba(0, 0, 0, 0.7);
}

.medallist > span:nth-child(2) {
  flex: 1 1 auto;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-weight: bold;
  font-size: 1.5rem;
  min-width: 0;
}

.medallist > span:nth-child(3) {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-end;
  text-align: right;
  white-space: nowrap;
  min-width: 6em;
  max-width: 8em;
}

.medallist > span:nth-child(3) .total-count {
  font-weight: 700;
  font-size: 1.2em;
  color: #fff;
}

.medallist > span:nth-child(3) small {
  font-size: 0.75em;
  color: #aaa;
}


#returnButton {
  appearance: none;
  padding: 0.4em 0.6em;
}

  </style>
</head>
<body>
  <h1 id="mainTitle">The Penny Bank</h1>
  <div class="controls">
    
  <div class="penny-controls" id="pennyControls">
    <select id="modeSelect">
      <option value="credits">Author Credits</option>
      <option value="current" selected>Current Season</option>
      <option value="total">All-Time</option>
    </select>
    <input type="text" id="searchInput" placeholder="Filter Players..." style="width: 200px;">
  </div>
  <br>
  <select id="formatSelect">
    <option value="leaderboard">The Penny Bank</option>
  </select>
  
</div>
  <div id="leaderboard" class="leaderboard fade"></div>
  
  <div id="medalBoard" class="medal-board fade" style="display: none;"></div>

  <script>
    const DATA_URL = 'https://raw.githubusercontent.com/persephoneschair/PennyStorage/main/NewPennys.txt';
    const FORMATS = ['Abyss.txt', 'Battlefront.txt', 'BiddingWar.txt', 'Crossfire.txt', 'Cryptex.txt', 'DangerZone.txt', 'DataLeak.txt', 'Distinction.txt', 'EscapeArtist.txt', 'GoogleThat.txt', 'Hive.txt', 'HiveLeaderboard.txt', 'Mole.txt', 'MoleLeaderboard.txt', 'Moneybox.txt', 'MoneyboxLeaderboard.txt', 'Purge.txt', 'Pyramid.txt', 'RedHerrings.txt', 'RiskyBusiness.txt', 'Spotlight.txt', 'SpotlightLeaderboard.txt']; // Update with real format file names
    const FORMAT_LABELS = {
      "Abyss.txt": "The Abyss",
      "Battlefront.txt": "Battlefront",
      "BiddingWar.txt": "Bidding War",
      "Crossfire.txt": "Crossfire",
      "Cryptex.txt": "Cryptex",
      "DangerZone.txt": "DangerZone",
      "DataLeak.txt": "Data Leak",
      "Distinction.txt": "Distinction!",
      "EscapeArtist.txt": "The Escape Artist",
      "GoogleThat.txt": "Google That!",
      "Hive.txt": "The Hive",
      "HiveLeaderboard.txt": "The Hive Leaderboard",
      "Mole.txt": "The Mole",
      "MoleLeaderboard.txt": "The Mole Leaderboard",
      "Moneybox.txt": "Moneybox",
      "MoneyboxLeaderboard.txt": "Moneybox Leaderboard",
      "Purge.txt": "The Purge",
      "Pyramid.txt": "The Pyramid",
      "RedHerrings.txt": "Red Herrings!",
      "RiskyBusiness.txt": "Risky Business",
      "Spotlight.txt": "Spotlight",
      "SpotlightLeaderboard.txt": "Spotlight Leaderboard"
    };

    let players = [];    

    async function fetchData() {
      try {
        const response = await fetch(DATA_URL);
        const data = await response.json();
        players = data.playerList.map(p => ({
          name: p.PlayerName,
          credits: p.AuthorCredits,
          current: p.CurrentSeasonPennys,
          total: p.AllTimePennys
        }));
        renderLeaderboard();
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    function renderLeaderboard() {
    
      document.getElementById('medalBoard').style.display = 'none';
      document.getElementById('leaderboard').style.display = 'grid';
      document.getElementById('mainTitle').textContent = 'The Penny Bank';
      document.title = 'The Penny Bank';

      const mode = document.getElementById('modeSelect').value;
      const search = document.getElementById('searchInput').value.toLowerCase();
      const board = document.getElementById('leaderboard');
      board.innerHTML = '';

      const filtered = players
        .filter(p => p[mode] && parseFloat(p[mode]) > 0)
        .sort((a, b) => parseFloat(b[mode]) - parseFloat(a[mode]));

      filtered.forEach((player, index) => {
        if (!player.name.toLowerCase().includes(search)) return;

        const div = document.createElement('div');
        div.className = 'entry';
        if (index === 0) div.classList.add('gold');
        else if (index === 1) div.classList.add('silver');
        else if (index === 2) div.classList.add('bronze');

        div.innerHTML = `
          <span class="ordinal">${index + 1}</span>
          <span class="name" title="${player.name}">${player.name}</span>
          <span class="value">${Number(player[mode]).toLocaleString()}</span>
        `;
        board.appendChild(div);
        
      });
    }
    
    function renderFormatLeaderboard(data, label) {
  const board = document.getElementById('medalBoard');
  const leaderboard = document.getElementById('leaderboard');
  const pennyControls = document.getElementById('pennyControls');

  fadeSwitch(leaderboard, board, () => {
    board.innerHTML = '';
    board.style.display = 'grid';
    document.getElementById('mainTitle').textContent = `${label}`;
    document.title = label;
    pennyControls.style.display = 'none';

    const sorted = [...data].sort((a, b) => b.playerScore - a.playerScore);

    sorted.forEach((entry, index) => {
      const row = document.createElement('div');
      row.className = 'medallist';
      row.innerHTML = `
        <span class="ordinal-medal">${index + 1}</span>
        <span class="name" title="${entry.playerName}">${entry.playerName}</span>
        <span class="value">${entry.playerScore.toLocaleString()}</span>
      `;
      board.appendChild(row);
    });

    // ✅ Attach handlers *after* rows exist
    attachPlayerClickHandlers();
  });
}

  function renderMedalBoard(data, label) {
  document.getElementById('leaderboard').style.display = 'none';
  const board = document.getElementById('medalBoard');
  board.innerHTML = '';
  board.style.display = 'grid';
  document.getElementById('mainTitle').textContent = `${label} Medal Cabinet`;
  document.title = `${label} Medal Cabinet`;

  const types = ['gold', 'silver', 'bronze', 'lobby'];
  const medalCounts = {};

  types.forEach(type => {
    const list = data[type + 'Medallists'] || [];
    list.forEach(name => {
      if (!medalCounts[name]) medalCounts[name] = { gold: 0, silver: 0, bronze: 0, lobby: 0 };
      medalCounts[name][type]++;
    });
  });

  const players = Object.entries(medalCounts).map(([name, counts]) => ({
    name,
    gold: counts.gold || 0,
    silver: counts.silver || 0,
    bronze: counts.bronze || 0,
    lobby: counts.lobby || 0,
    total: (counts.gold || 0) + (counts.silver || 0) + (counts.bronze || 0) + (counts.lobby || 0)
  }));

  players.sort((a, b) => {
    if (b.gold !== a.gold) return b.gold - a.gold;
    if (b.silver !== a.silver) return b.silver - a.silver;
    if (b.bronze !== a.bronze) return b.bronze - a.bronze;
    if (b.lobby !== a.lobby) return b.lobby - a.lobby;
    return b.total - a.total;
  });

  function getOrdinalLabels(list) {
    let labels = [];
    let currentRank = 1;
    for (let i = 0; i < list.length; i++) {
      const cur = list[i];
      const prev = i > 0 ? list[i - 1] : null;
      if (
        prev &&
        cur.gold === prev.gold &&
        cur.silver === prev.silver &&
        cur.bronze === prev.bronze &&
        cur.lobby === prev.lobby &&
        cur.total === prev.total
      ) {
        labels.push(`=${currentRank}`);
      } else {
        currentRank = i + 1;
        const next = i < list.length - 1 ? list[i + 1] : null;
        if (
          next &&
          cur.gold === next.gold &&
          cur.silver === next.silver &&
          cur.bronze === next.bronze &&
          cur.lobby === next.lobby &&
          cur.total === next.total
        ) {
          labels.push(`=${currentRank}`);
        } else {
          labels.push(`${currentRank}`);
        }
      }
    }
    return labels;
  }

  const ordinals = getOrdinalLabels(players);

  players.forEach((player, index) => {
    const breakdown = `
      ${player.gold ? `🥇${player.gold} ` : ''}
      ${player.silver ? `🥈${player.silver} ` : ''}
      ${player.bronze ? `🥉${player.bronze} ` : ''}
      ${player.lobby ? `✨${player.lobby}` : ''}
    `.trim();

    const row = document.createElement('div');
    row.className = 'medallist';
    row.innerHTML = `
      <span class="ordinal-medal">${ordinals[index]}</span>
      <span title="${player.name}">${player.name}</span>
      <span>
        <span class="total-count">🏆 ${player.total}</span>
        <small>${breakdown}</small>
      </span>
    `;

    // Add click handler to load player's medal cabinet
    row.style.cursor = 'pointer';
    row.onclick = () => {
      renderPlayerCabinet(player.name);
    };

    board.appendChild(row);
  });
}

function getChunkSize() {
  const width = window.innerWidth;
  if (width < 600) return 1;
  if (width < 900) return 2;
  if (width < 1200) return 3;
  if (width < 1800) return 4;
  return 5;
}

// ------------------
// 1. Render Player Cabinet
async function renderPlayerCabinet(playerName) {
  const board = document.getElementById('medalBoard');
  const leaderboard = document.getElementById('leaderboard');
  const pennyControls = document.getElementById('pennyControls');
  const formatSelect = document.getElementById('formatSelect');

  fadeSwitch(leaderboard, board, async () => {
    board.innerHTML = '';
    document.getElementById('mainTitle').textContent = `${playerName}'s Medal Cabinet`;
    document.title = `${playerName}'s Medal Cabinet`;

// Hide format dropdown and controls
formatSelect.style.display = 'none';
pennyControls.style.display = 'none';

// Only add the button if it doesn't already exist
let backBtn = document.getElementById('returnButton');
if (!backBtn) {
  backBtn = document.createElement('button');
  backBtn.id = 'returnButton';
  backBtn.textContent = '🔙 Back';

  // Use the regular entry class (like a standard strap)
  backBtn.className = 'entry';
  backBtn.style.width = '100%';
  backBtn.style.justifyContent = 'center';
  backBtn.style.fontSize = '1.5rem';
  backBtn.style.fontWeight = 'bold';
  backBtn.style.padding = '0.75rem 1.25rem';
  backBtn.style.marginBottom = '1rem';
  backBtn.style.color = '#e0e7ff'; // match strap text color

  backBtn.onclick = () => {
    backBtn.remove(); // remove the button
    formatSelect.style.display = 'inline-block';
    pennyControls.style.display = 'inline-block';
    formatSelect.dispatchEvent(new Event('change'));
  };

  // Insert it where the format selector was
  formatSelect.parentNode.insertBefore(backBtn, formatSelect);
}

    // Load Penny data
    const resp = await fetch(DATA_URL);
    const allData = await resp.json();
    const playerObj = allData.playerList.find(p => p.PlayerName === playerName);

    // Render Penny counts as leaderboard-style rows
    const statMap = [
      { label: 'Current Season Pennys', key: 'CurrentSeasonPennys' },
      { label: 'All-Time Pennys', key: 'AllTimePennys' },
      { label: 'Author Credits', key: 'AuthorCredits' }
    ];

    statMap.forEach(({ label, key }) => {
  const val = playerObj[key];
  if (val > 0) {
    const row = document.createElement('div');
    row.className = 'entry gold stat-row';  // gold style for emphasis
    row.innerHTML = `
      <span class="name">${label}</span>
      <span class="value">${Number(val).toLocaleString()}</span>
    `;
    board.appendChild(row);
  }
});

    // Loop through each format and tally medals
    for (const fmt of FORMATS) {
      const res = await fetch(`https://raw.githubusercontent.com/persephoneschair/PennyStorage/main/${fmt}`);
      const data = await res.json();
      const types = ['gold', 'silver', 'bronze', 'lobby'];
      const counts = { gold: 0, silver: 0, bronze: 0, lobby: 0 };

      types.forEach(type => {
        (data[type + 'Medallists'] || []).forEach(name => {
          if (name === playerName) counts[type]++;
        });
      });

      const total = Object.values(counts).reduce((a, b) => a + b, 0);
      if (total === 0) continue;

      const breakdown = `
        ${counts.gold ? `🥇${counts.gold} ` : ''}
        ${counts.silver ? `🥈${counts.silver} ` : ''}
        ${counts.bronze ? `🥉${counts.bronze} ` : ''}
        ${counts.lobby ? `✨${counts.lobby}` : ''}
      `.trim();

      const row = document.createElement('div');
      row.className = 'medallist';
      row.innerHTML = `
        <span></span>
        <span class="name">${FORMAT_LABELS[fmt] || fmt.replace('.txt', '')}</span>
        <span>
          <span class="total-count">🏆 ${total}</span>
          <small>${breakdown}</small>
        </span>
      `;
      board.appendChild(row);
    }
  });

  // Hide sort/filter UI
  pennyControls.style.display = 'none';
}

// ------------------
// 2. Bind click handlers
function attachPlayerClickHandlers() {
  document.querySelectorAll('.entry, .medallist').forEach(el => {
    const name = el.querySelector('.name')?.textContent;
    if (name) {
      el.style.cursor = 'pointer';
      el.onclick = () => renderPlayerCabinet(name);
    }
  });
}

// ------------------
// 3. Wrap fadeSwitch (if not already defined)
async function fadeSwitch(fromEl, toEl, callback) {
  fromEl.classList.add('hidden');
  await new Promise(res => setTimeout(res, 400));
  fromEl.style.display = 'none';
  toEl.style.display = 'grid';
  void toEl.offsetWidth;
  toEl.classList.remove('hidden');
  if (callback) callback();
}

// ------------------
// 4. Ensure handlers reattach on render
const originalLeaderboard = renderLeaderboard;
renderLeaderboard = function() {
  originalLeaderboard();
  attachPlayerClickHandlers();
};

const originalMedalBoard = renderMedalBoard;
renderMedalBoard = function(data, label) {
  originalMedalBoard(data, label);
  attachPlayerClickHandlers();
};

const originalFormatLeaderboard = renderFormatLeaderboard;
renderFormatLeaderboard = function(data, label) {
  originalFormatLeaderboard(data, label);
  attachPlayerClickHandlers();
};

// Initialize
document.getElementById('pennyControls').style.display = 'inline-block';


    document.getElementById('modeSelect').addEventListener('change', renderLeaderboard);
    document.getElementById('searchInput').addEventListener('input', renderLeaderboard);
   document.getElementById('formatSelect').addEventListener('change', async function () {
  const val = this.value;

  if (val === 'leaderboard') {
    renderLeaderboard();
    return;
  }

  const pennyControls = document.getElementById('pennyControls');
  pennyControls.style.visibility = 'hidden';
  pennyControls.style.opacity = '0';

  try {
    const response = await fetch(`https://raw.githubusercontent.com/persephoneschair/PennyStorage/main/${val}`);
    const data = await response.json();

    if (val.endsWith('Leaderboard.txt')) {
      renderFormatLeaderboard(data, FORMAT_LABELS[val] || val.replace('.txt', ''));
    } else {
      renderMedalBoard(data, FORMAT_LABELS[val] || val.replace('.txt', ''));
    }
  } catch (err) {
    console.error('Error loading view:', err);
  }
});

    FORMATS.forEach(name => {
      const opt = document.createElement('option');
      opt.value = name;
      opt.textContent = FORMAT_LABELS[name] || name.replace('.txt', '');
      document.getElementById('formatSelect').appendChild(opt);
    });

    fetchData();
  </script>
</body>
</html>
